<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Description" content="Create and manage U.S. Small Business Administration events">
    <title>USSBA Events</title>
    <link rel="stylesheet" href="assets/css/uswds.min.css">
    <script src="./assets/js/uswds-init.min.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="public/favicon.ico">
</head>

<body>
    <header>
        <nav>
            <span id="menu-title"><a href="index.html"><img id="agency" src="public/agency-logo.png"
                        alt="SBA Logo"></a></span>
            <span id="menu-create"><a href="create.html">Create</a></span>
            <span id="menu-view"><a href="view.html">View</a></span>
            <span id="menu-approve"><a href="approve.html">Approve</a></span>
            <span id="menu-recurring"><a href="login.html">Login</a></span>
        </nav>
    </header>
    <main>
        <h1>Create an Event</h1>
        <form action="https://eventadmin.ussba.io/api/events" id="event-form">
            <label>UserID</label>
            <input type="text" name="userID">
            <br>
            <label>EventID</label>
            <input type="number" name="eventID">
            <br>
            <label>Title</label>
            <input type="text" id="sample-name-form" name="title">
            <br>
            <label>Description</label>
            <textarea rows="5" name="description"></textarea>
            <input type="submit">
        </form>
        <div class="flash-container" hidden aria-hidden="true">
            <div class="usa-alert usa-alert--success usa-alert--slim">
                <div class="usa-alert__body">
                    <p class="usa-alert__text">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod.
                    </p>
                </div>
            </div>
        </div>
    </main>
    <script>
        /**
         * https://simonplend.com/how-to-use-fetch-to-post-form-data-as-json-to-your-api/
         * Helper function for POSTing data as JSON with fetch.
         *
         * @param {Object} options
         * @param {string} options.url - URL to POST data to
         * @param {FormData} options.formData - `FormData` instance
         * @return {Object} - Response body from URL that was POSTed to
         */
        async function postFormDataAsJson({
            url,
            formData
        }) {
            const plainFormData = Object.fromEntries(formData.entries());
            const formDataJsonString = JSON.stringify(plainFormData);

            const fetchOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json",
                },
                body: formDataJsonString,
            };

            const response = await fetch(url, fetchOptions);

            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(errorMessage);
            }

            return response.json();
        }

        /**
         * Event handler for a form submit event.
         *
         * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event
         *
         * @param {SubmitEvent} event
         */
        async function handleFormSubmit(event) {
            event.preventDefault();

            const form = event.currentTarget;
            const url = form.action;

            try {
                const formData = new FormData(form);
                const responseData = await postFormDataAsJson({
                    url,
                    formData
                });

                console.log({
                    responseData
                });
                // Need to flash success (or failure here)

                event.target.reset();
            } catch (error) {
                console.error(error);
            }
        }

        const eventForm = document.getElementById("event-form");
        eventForm.addEventListener("submit", handleFormSubmit);
    </script>
    <script src="./assets/js/uswds.min.js"></script>
    <footer>
        <a href="https://www.sba.gov">U.S. Small Business Administration</a> | 409 3rd St, SW. Washington, DC 20416
    </footer>
</body>

</html>